
service: qa-base-mvp
image: xitester/qa-base-mvp


servers:
  web:
    hosts:
      - 143.110.250.31
  
  celery:
    hosts:
      - 143.110.250.31
    cmd: celery -A app.celery_app worker --loglevel=info



proxy: 
  ssl: true
  app_port: 8005
  forward_headers: true
  response_timeout: 3600
  host: qa-base-mvp.qola.top
  healthcheck:
    interval: 3
    timeout: 300


registry:
  server: 248189925495.dkr.ecr.ap-southeast-1.amazonaws.com
  username: AWS
  password: <%= %x(aws ecr get-login-password) %>


builder:
  arch:
    - amd64
  dockerfile: backend/Dockerfile
  context: .
  args:
    BUILDKIT_INLINE_CACHE: 1


env:
  clear:
    DEBUG: "false"
    APP_NAME: "QA Base API"
    DATABASE_URL: "sqlite:///./data/app.db"
    CELERY_BROKER_URL: "redis://qa-base-redis:6379/0"
    CELERY_RESULT_BACKEND: "redis://qa-base-redis:6379/0"
    PYTHONUNBUFFERED: "1"
  secret:
    - GEMINI_API_KEY
    - BROWSER_USE_API_KEY


volumes:
  - qa-base-data:/app/data
  - qa-base-screenshots:/app/data/screenshots


# ============================================
# Accessories
# ============================================
accessories:
  redis:
    image: redis:latest
    port: "127.0.0.1:6375:6375"
    host: devbox.flutr.io
    cmd: "/bin/sh -c 'redis-server --port 6375'"
    volumes:
      - qa-base-redis-data:/data


  frontend: 
    image: ghcr.io/<your-username>/qa-base-frontend
    host: <your-server-ip>
    port: 80:80
    env:
      clear:
        VITE_API_URL: "https://api.yourdomain.com"
    options:
      health-cmd: wget --spider -q http://localhost/
      health-interval: 10s

# ============================================
# Aliases
# ============================================
aliases:
  shell: app exec --interactive bash
  logs: app logs
  console: app exec --interactive python
  migrate: app exec "alembic upgrade head"
